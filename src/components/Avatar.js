import React, { useCallback, useEffect, useState } from "react";
import styled from "styled-components";

const Image = styled.img`
  border-radius: 50%;
  width: 2em;
  height: 2em;
  object-fit: cover;
  object-position: center;
`;

const fallbackAvatar =
  // eslint-disable-next-line max-len
  "data:image/jpeg;base64,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";

const Avatar = ({ src, ...rest }) => {
  const [loadFailed, setLoadFailed] = useState(false);

  useEffect(() => {
    setLoadFailed(false);
  }, [src]);

  const onError = useCallback(() => {
    setLoadFailed(true);
  }, [setLoadFailed]);

  return (
    <Image
      {...rest}
      src={loadFailed ? fallbackAvatar : src}
      onError={onError}
    />
  );
};

export default Avatar;
